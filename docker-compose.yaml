services:
  yanblog:
    build: .
    ports:
      - "3002:80"   # Public Frontend
      - "3011:81"   # Admin Backend
    volumes:
      # Uploads Persistence
      - yanblog_upload_data:/app/uploads
      # Static assets persistence?
      # If user wants to edit about.md (which is in web/frontend/public/static/about.md),
      # effectively /usr/share/nginx/html/web/static/about.md.
      # If we want it persistent, we should map a volume there too.
      # But the user said "resource files go into upload" in the previous turn, and then reverted.
      # But logically using uploads for dynamic content is best.
      # For now, about.md updates will be written to /app/web/frontend/public/static/about.md by Go code?
      # Wait, Go code writes to "web/frontend/public/static/about.md" (relative to WorkDir /app).
      # The container WorkDir is /app.
      # So Go writes to /app/web/frontend/public/static/about.md.
      # Nginx serves /usr/share/nginx/html/web/static.
      # THESE ARE DIFFERENT PATHS!
      # We need to map or symlink them.
      
    depends_on:
      - db
    networks:
      - yanblog-network
    restart: always

  db:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: yanblog
    volumes:
      - yanblog_db_data:/var/lib/mysql
    networks:
      - yanblog-network
    restart: always

networks:
  yanblog-network:
    driver: bridge

volumes:
  yanblog_db_data:
  yanblog_upload_data:
